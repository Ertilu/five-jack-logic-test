"use strict"

// REZA RAKA NUGRAHA
// question 2 assignment at PT Five Jack

const solution = (N, users = []) => {
    let answer = []

    let stages = []
    let usersPlay = []
    let usersLose = []

    let data = []

    let survivorPlayers = users.length
    let failureRate = []
    let sortFailureRate = []

    users.sort((a,b) => a-b)
    let current = null
    let counter = 0
    
    for (let i = 0; i < users.length; i++) {
        // users = 1, 2, 2, 2, 3, 3, 4, 6
        if(users[i] != current) {
            if(counter > 0) {
                usersPlay.push(current)
                usersLose.push(counter)
            }
            current = users[i]
            counter = 1
        } else {
            counter++
        }
    }
    
    if (current <= N) {
        if(counter > 0) {
            usersPlay.push(current)
            usersLose.push(counter)
        }    
    }
    
    // loop for create how many stages there are
    for(let s = 1; s <= N; s++) {
       stages.push(s)
    }
    
    // loop to check where users lose at that stage 
    for(let l = 0; l < stages.length; l++) {
        // check if no one has complete last stage
        if (usersLose[l] === undefined) {
            failureRate.push(0 / survivorPlayers) 
        }  else {
            failureRate.push(usersLose[l] / survivorPlayers) 
        }
        survivorPlayers = survivorPlayers - usersLose[l]

        // failureRate.sort((a,b) => a*b)
        // loop for insert failure rate to the output and then sort them
        for(let d=0; d < failureRate.length; d++) {
            data[d] = {
                stages: stages[d],
                failureRate: failureRate[d]
            }
        }
    } 
    
    // sort the answer object so the return value is descending
    data.sort((a,b) => (a.failureRate < b.failureRate) ? 1 : (a.failureRate === b.failureRate) ? ((a.stages > b.stages) ? 1 : -1) : -1 )
    
    // insert the stages to the output
    for(let x = 0; x < stages.length; x++) {
        answer.push(data[x].stages)
    }

    return answer
}

console.log(solution(4, [4,4,4,4,4,4,4,4,4]))

// expected output [3,4,2,1,5]
